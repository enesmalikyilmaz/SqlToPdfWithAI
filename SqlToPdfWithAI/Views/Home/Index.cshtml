@{
    ViewData["Title"] = "SQL to PDF";
}

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', () => {
          const btn = document.querySelector('button[type="submit"]');
          const txt = document.getElementById('sql');
          btn.disabled = false;

          document.querySelector('form').addEventListener('submit', async (e) => {
            e.preventDefault();
            btn.disabled = true;
            btn.textContent = 'Çalıştırılıyor...';

            const sql = txt.value;
            const resp = await fetch('/api/query', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ sql })
            });

            if (!resp.ok) {
              const msg = await resp.text();
              alert('Hata: ' + msg);
              btn.disabled = false;
              btn.textContent = 'Rapor Al';
              return;
            }

            const data = await resp.json();
            console.log('QueryResult', data);
            alert(`Satır: ${data.rowCount} | Süre: ${data.durationMs}ms\n3. günde PDF hazırlayacağız.`);
            btn.disabled = false;
            btn.textContent = 'Rapor Al';
          });
        });
    </script>
}

